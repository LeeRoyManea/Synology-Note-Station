# copied/inspired from https://github.com/flathub/com.synology.SynologyDrive/blob/master/com.synology.SynologyDrive.yaml
id: com.synology.synology-note-station
runtime: org.freedesktop.Platform
runtime-version: "23.08"
sdk: org.freedesktop.Sdk
command: launch.sh
finish-args:
  - --share=network
  - --socket=x11
  - --share=ipc
  - --persist=.syno_ns_app
  - --persist=.note_data
  - --persist=.syno_ns_backup
modules:
  - name: com.synology.synology-note-station
    buildsystem: simple
    sources:
      - type: file
        sha256: a4c763bddda21bd211b0c8afdcff7e72a3edddc2392470fec8ce8123a0531751
        url: "https://global.synologydownload.com/download/Utility/NoteStationClient/2.2.4-703/Ubuntu/x86_64/synology-note-station-client-2.2.4-703-linux-x64.deb"        
      - type: file
        path: com.synology.synology-note-station.metainfo.xml
      - type: file
        path: patched_launch.sh
    build-commands:
       # unzip folder
      - ar x synology-note-station-client-2.2.4-703-linux-x64.deb
      - tar -xf data.tar.xz
      - 
      # move to app location
      - mv usr/share /app/share
      - mv opt /app/opt
      - 
      # replace launch.sh with patched
      - rm /app/opt/synology-note-station/launch.sh
      - mv patched_launch.sh /app/opt/synology-note-station/launch.sh
      - chmod +x /app/opt/synology-note-station/launch.sh

      # link launch.sh
      - mkdir -p /app/bin/
      - ln -s /app/opt/synology-note-station/launch.sh /app/bin/launch.sh
      
      # rename some files
      - mv /app/share/applications/synology-note-station-client.desktop /app/share/applications/com.synology.synology-note-station.desktop
      - find /app/share/icons/hicolor -type f -execdir sh -c 'mv "$0" com.synology.synology-note-station.png' {} \;
      
      # update desktop file
      - desktop-file-edit --remove-key=Version /app/share/applications/com.synology.synology-note-station.desktop
      - desktop-file-edit --set-key=Exec --set-value=launch.sh /app/share/applications/com.synology.synology-note-station.desktop
      - desktop-file-edit --set-icon com.synology.synology-note-station.png /app/share/applications/com.synology.synology-note-station.desktop
    
    # install metadata
      - install -Dm644 com.synology.synology-note-station.metainfo.xml -t /app/share/metainfo
